(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{276:function(t,s){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOsAAACZCAYAAADO4M0fAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAt5SURBVHhe7d1PTFNrGsfx50wmmRndzHYW8iehEo3MTIIb6kTDNWECuuhl0QULNd6kncWYCyYmsjBqvAkmJorjLC5NNOiCBQsvC27JkFyIZoSNJDOjwWCbCHdzt65mZjFJ533PeVsOpUCRQvscv5/k0J5/bcHzO8/znhb0Dh8+XBCjUPBvADQYz/OC2yNHjpBSQAHPVFTCCjS4pqYm+Zm7D6DBEVZACcIKKEFYASUIK6BEDcM6I2kvbb6W3290O7zWmbR4px5K3s0C9RIKa14envIkXX7U5h/KqToFbybtiVf2gvIPT20KT6Vl+8W+plMPiS62Zz/IsLS05OY2s+uKH3aoVkO3wb2JlMjb96EQ5uX7yQWRhUn5PpSX3PKCxJPnpM3NA/X2+vVr6Tr1h4qBtcvsOrvNbjT2mDV2XOIbgpmT5YWUpFILspxzi0yA37+NS/LcwUQ1djzu7gFb6+zslMVXf98U2GJQ7Tq7zW58QljtGM+0p26qriXcuI9XbVvddk6S8VAwZ6Ykk0rINROYzJR7hPz3MrlwQo6WsrrdcxVbfbdNxda5bP++jFsO7E55YPcSVGtTWDN9oQPVTrFBMY2nYw/kb+R4ruB/8L9QyElyMrZ5nLuB3adP3o7m3D5myor0VRXYNjmXXA/mzFRGUolek+GkxIvtcW5ZFkyAe4MtqnquTN+UJOy6V1+Xtc7B/pJ1+5opazpx4FOFA7uXoFqbwpoKHaj+lBuVUuNnK5uJ7mCsGOaYDJokv32/TXW1+8RH5enXoVj0XpPReEaKxXE768EM2t3jMX+hJCVoj22A4/5Co8rnSmXHXLjLuP2vhVb642agAey+DTYHcy4cZjO9Coejai54O2k7KicWliVn210T0WBo2iZHT9j2uNrxapXPBdRYuPUNt8SfYndh7U1IamFQ7oWq1Ex6h3bW7XMxPLaduSeDpeDtpFcSKVMZ7y2LSWWpbbUVLzN1T5bDj7PX59r0/Zkx7jcbx6xtX7/6xJMTPjflY9TyMexu7bKy9sqYaYvfhsa1U4ktWsoSs48ZOJ4YjJX28YeFxfFiFe/j+sHMZOTE+lWkIFhmWebE0dC4c4fn2pHZ3wxS18ftF80JItwGBxeoyt/7BcptdTFpL4Gt/++z2k8ITSWkMLZ95AFN7Mnevo+61cUkG9STJ0/6w8hqNMTvs+bfv/Wv8AJRYkO4VVAtu263dZK/FAEowF+KABQhrIAShBVQgrACShBWQAnCCihBWAElCCugBGEFlCCsgBKEFVCCsAJKEFZACcIKKEFYASUIK6AEYQWUIKyAEoQVUIKwAkoQVkAJwgooQVgBJQgroARhBZQgrIAShBVQgrACShBWQAnCCihBWAElCCugBGEFlCCsgBKEFVCCsAJKEFZAic8grDOS9uIymnezgFK7DKs98NPm636yz+GJV/48+VGJ7/tzF+VlNL4e8Pxo3Lwe+5rsVFzOSQAHq0Era5d0dWXkTiMkYSYtscmk5AoFKfjTggy2uXXSIe2l+8D+qlFYi9XQTWlX/1w1HC1VJlsZQ9sWt6sg+SwrHUMXtq5c/mO7xzHThocyASsu99JTbqETXhcfNTUU0KFGYe2VsVLlyUoqcycUsoxMyjN/XTaVkT5vShIVtytnHjPbIUMXKgTKBjU2Kcmce87cA3nT51pSu67vjTworkvYV+DYdXeOlapkLjkpF3aq3r1jku0YkpgJd3ynbYF9VMM22I7zbMXqM+FYlHc5t1hScsP1jbFjXWY2YWLoz8mxrvB2Fbig3CsvwLl3spi6sd6Otg3KjZR7rPJ1vQnzCgL56UlZXAyCZytrbGhRFrd9AYHeMRvunCQnY2a/gxo3AxvVJqx+a3lB5FlwUD8wmayV3rGsSF/1AcmvvHH3tpDKBhW3OI0Fp46dtcngQtAdBGNpe7IJ1gAHoSZh9QNSrGb5aZlcDJbXhm2HTV4vTLp5I3ZMusIttGlv72S65FjMROp8csO6/OidUhtcvk5mRiu34f734C4emRPR+ng4L/Zb7fBX2PCOuS4B2H81CWvb4A0z/uwLLtpceCcdta44fjtsWlY3a9veBTuejbkLRf741V2lNeuePZDSuti7jlIbXL7Om2oP9vE7g9DFr9iQdGRdEM1zJ6bc9l5Mhjqy4hdj/wIXb93g4HimFSy4+wAaVFNTUy0vMAHYT4QVUIKwAkoQVkAJwgooQVgBJQgroARhBZQgrIAShBVQgrACShBWQAnCCihBWAElCCugBGEFlCCsgBKEFVCCsAJKEFZACcIKKEFYASUIK6AEYQWUIKyAEoQVUIKwAkoQVkAJwgooQVgBJQgroIT38eNH/n9WoMF1dHRQWQEtCCugBGEFlCCsgBKEFVCCsAJKEFZACcIKKEFYASUIK6AEYQWUIKyAEnX/IP+v7/7k7qGWPl7/jbu3vR9++MHdQy2dPXvW3asN+0H+hgjrL37uiefmsXf//V9hV2E9efKkm0MtvH79Orph/aUJ60rqkPz+t7+Tf/zrn9zu4fY/f14krHUW+bD+6q9d/gGHvWnP/Juw1tl+hbVhLjAR1L2zlRXR1TBh5UDbO0540UZljRBOeNFGZY0QTnjRRmWtZPWJ9F+fdzPbmLsuzV8+kVU3W28aT3jzw83S3Fw2DW/xs58flub+4Oc9P9wvT9wPfvVJv5R2Mdtstbt2n31lnb/eJM1Nxem6zJtD4cnQLVmauFha3v+4dFRIf2lbM12aEFm6JWfCy8w0PBdsftA0VtbukRdys3NAxtfWZG1tXAY6b8p47NGmAPsB7B6RtfsiV01gW0euSO5q+YlyXoYfxSTd7WYj5rOvrN13f5S1H5/KwMBTc3tXWh9/K/LALjPTy1vS2XlL7n/V4rY2/O3c+grTi5udbsODp3coMSGX/FBeMvdEWi9fMf8e4ya8NsBrMj7QKbHWYEtpuSzPn1+WFumWkSs5uVosr8b88COJ3bfrookxqzX3N5Eeczo2be3V6RW5fdpVydOmwrrK6VdXe6Dc3f603fLVdzLyhZs5YHrHrKHK6s+3Skw+uKq5Kh9W2qW1xXQ8/a7C2qWm9bWdzdLtM3Lm9pJMXGqWSxNLcvvM+jZRw5jVtr2PJsw/tgnno6Ny/0q7q54vg/bMVszx4BBaffzlhnZ3q6nUNh+wqFRWc8ozcZ2WOftjXJ2T6fYeU0db5PLzNemZXQ/jwHhQecNTPTub/UZlnftWbi/ZUJpW2C0Sf7x62iw3B5ENoB2bGrZqlre9tkW7+XLjsufhtvkARaeymuFJT7tMm7Suzk1Lu+16nO6RNRlxs7aalo9tbZWNqs+8spqqOmsOlfKT8RaVNWD2+dJeiCoyrVexbbZTHa8O662sFXT3SLttcafPb7hgFL4KTGWtk/ocaKa1uvsnMz5a9+HDypaV1ee3ZX80bVlRWWX9rn4XOPRWVsO+LWPb4KXbcqZ52JwMu6XHniPbW0M/z3mZXTkvX7gFVNY6qe+BZkN50Xx9L7PTS+aMbYNXqbIGb+vIyl8a6v3VIn2V1V40OhOcFGd7gja486a8WEvLh/5mme0xldK+jVMcpM7PykQovFTWOqnvgeZC+eCorLQ/3XA1d9a+D2sqa3tri8xfPy3T51/K8+/M2PXKe/8qsX8FMtwG26maD1TsA32VNbho5AetOBD1K+tVkfvB2LTl8vNSYFdN1zMQGr+us6EvVlZZf5snYhrq91mxN/aEx++z1l/kf0UuUhdH6kT1mBU7YswaIZzwoo3KGiGc8KKNyhohnPCireEqK7effssJL9oa5mowaoerwfUV6b9uiNrbTVhRe5EMK4CdNdT7rAC2R1gBJQgroARhBZQgrIAShBVQgrACShBWQAnCCihBWAElCCugBGEFlPCOHDnCB/kBBbxDhw5VDGuhQIaBevK88O95i/wfP1m7Yo6niMkAAAAASUVORK5CYII="},277:function(t,s,n){t.exports=n.p+"assets/img/2-2.9fbd880b.png"},278:function(t,s,n){t.exports=n.p+"assets/img/2-4.c2a4abd2.png"},279:function(t,s,n){t.exports=n.p+"assets/img/2-3.de4797df.png"},280:function(t,s,n){t.exports=n.p+"assets/img/2-5.442b2215.png"},317:function(t,s,n){"use strict";n.r(s);var a=n(13),e=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"electron-学习-调用-dll"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#electron-学习-调用-dll"}},[t._v("#")]),t._v(" electron 学习--调用 .dll")]),t._v(" "),s("h2",{attrs:{id:"引言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#引言"}},[t._v("#")]),t._v(" 引言")]),t._v(" "),s("p",[t._v("本文使用 node-ffi/ffi-napi 调用 C/C++编写的动态链接库(即 dll)，以实现一些硬件功能。")]),t._v(" "),s("h2",{attrs:{id:"ffi"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ffi"}},[t._v("#")]),t._v(" ffi")]),t._v(" "),s("blockquote",[s("p",[t._v("node-ffi 是一个用于使用纯 JavaScript 加载和调用动态库的 Node.js 插件。它可以用来在不编写任何 C++代码的情况下创建与本地 DLL 库的绑定。同时它负责处理跨 JavaScript 和 C 的类型转换。")])]),t._v(" "),s("ul",[s("li",[t._v("node-ffi 连接了 C 代码和 JS 代码, 通过内存共享来完成调用, 而内部又通过 ref,ref-array 和 ref-struct 来实现类型转换.")])]),t._v(" "),s("h2",{attrs:{id:"安装-ffi"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-ffi"}},[t._v("#")]),t._v(" 安装 ffi")]),t._v(" "),s("blockquote",[s("p",[t._v("ffi-napi 是作者(node-ffi-napi)根据 node-ffi 修改而发布到 npm 仓库的, 可以直接通过 npm 安装, 支持 node.js 12 和 electron 高版本.")])]),t._v(" "),s("ol",[s("li",[s("p",[t._v("部署 node.js+electron 环境\n请自行参照相关教程")])]),t._v(" "),s("li",[s("p",[t._v("安装 ffi-napi")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("yarn add ffi-napi\n")])])])]),t._v(" "),s("li",[s("p",[t._v("使用 ffi\n在"),s("code",[t._v("main.js")]),t._v("中添加以下代码：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ffi "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ffi-napi"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 先定义一个函数, 用来在窗口中显示字符\n * @param {String} text\n * @return {*} none\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("showText")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Buffer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("text"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ucs2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"binary"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过ffi加载user32.dll")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" myUser32 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ffi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Library")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user32"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 声明这个dll中的一个函数")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("MessageBoxW")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"int32"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"int32"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"int32"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用json的格式罗列其返回类型和参数类型")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 调用user32.dll中的MessageBoxW()函数, 弹出一个对话框")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" isOk "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" myUser32"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("MessageBoxW")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("showText")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"I am Node.JS!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("showText")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello, World!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("isOk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("启动程序：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("yarn start\n")])])]),s("p",[t._v("启动成功！出现了弹窗：")]),t._v(" "),s("p",[s("img",{attrs:{src:n(276),alt:"01"}})])])]),t._v(" "),s("h2",{attrs:{id:"自己生成一个-dll"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自己生成一个-dll"}},[t._v("#")]),t._v(" 自己生成一个 dll")]),t._v(" "),s("ol",{attrs:{start:"0"}},[s("li",[t._v("开始之前")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("注意：")]),t._v(" "),s("blockquote",[s("p",[t._v("ffi 只接受纯 C 函数, 确切的说, 是按照 C 标准编译的函数")])]),t._v(" "),s("p",[t._v("下面来说说具体的原因:")]),t._v(" "),s("p",[t._v("在通过 ffi 引入 dll 的时候, 我们是这么声明的:")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" myUser32 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ffi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Library")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user32"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 声明这个dll中的一个函数")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("MessageBoxW")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"int32"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"int32"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"int32"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用json的格式罗列其返回类型和参数类型")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("在"),s("code",[t._v("user32.dll")]),t._v("中, 寻找一个名字叫"),s("code",[t._v("MessageBoxW")]),t._v("的函数.")]),t._v(" "),s("p",[t._v("但是, C 和 C++的函数命名是不同的, 我指的是编译后的函数名字")]),t._v(" "),s("p",[t._v("对于 C, 函数"),s("code",[t._v("int func(int n)")]),t._v("会被编译为类似"),s("code",[t._v("_func")]),t._v("这样的名字.")]),t._v(" "),s("p",[t._v("对于 C++, 函数"),s("code",[t._v("int func(int n)")]),t._v("会被编译为类似"),s("code",[t._v("?func@@YAHH@Z")]),t._v("这样的名字.")]),t._v(" "),s("p",[t._v("同样是 C++, 函数"),s("code",[t._v("int func(int double)")]),t._v("会被编译为类似"),s("code",[t._v("?func@@YAHN@Z")]),t._v("这样的名字(和上一个不同).")]),t._v(" "),s("p",[t._v("名字中包含了较多信息, 比如:")]),t._v(" "),s("blockquote",[s("p",[t._v("参数的入栈方式\n返回值的类型\n参数的类型和数量")])]),t._v(" "),s("p",[t._v("这是因为 C++有"),s("code",[t._v("函数重载")]),t._v("特性, 虽然函数命名是"),s("code",[t._v("func")]),t._v(", 但"),s("code",[t._v("int func(int n)")]),t._v("和"),s("code",[t._v("int func(int double)")]),t._v("完全是两个不同的函数, 编译器通过给它们赋予不同的名字来区分它们.ffi 在 dll 中查找函数名字的时候, "),s("strong",[t._v("是用 C 风格来查找的")]),t._v(".")]),t._v(" "),s("ul",[s("li",[t._v("所以,如果你的函数使用 C++编译的, ffl 在这个 dll 中就找不到这个函数, 会出现错误"),s("code",[t._v("LINK 126")]),t._v("!")])])])]),t._v(" "),s("ol",[s("li",[s("p",[t._v("创建工程")]),t._v(" "),s("p",[t._v("使用 VS 创建一个 C++ "),s("strong",[t._v("空项目")]),t._v("即可. 项目名成以 myDLL 为例（当然, 你也可以直接创建动态链接库 DLL）:")]),t._v(" "),s("p",[s("img",{attrs:{src:n(277),alt:"02"}})])]),t._v(" "),s("li",[s("p",[t._v("函数声明\n创建一个 myAdd.h 头文件，并声明一个"),s("code",[t._v("funAdd")]),t._v("函数：")]),t._v(" "),s("div",{staticClass:"language-c++ extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('extern "C"\n{\n    __declspec(dllexport) int funAdd(int a, int b);\n}\n')])])]),s("p",[s("code",[t._v('extern "C"')]),t._v("的含义:")]),t._v(" "),s("blockquote",[s("p",[t._v('被 extern "C" 修饰的变量和函数是按照 C 语言方式编译和链接的')])]),t._v(" "),s("p",[s("code",[t._v("__declspec(dllexport)")]),t._v("的含义:")]),t._v(" "),s("blockquote",[s("p",[t._v("__declspec(dllexport)用于 Windows 中的动态库中，声明导出函数、类、对象等供外面调用，省略给出.def 文件。即将函数、类等声明为导出函数，供其它程序调用，作为动态库的对外接口函数、类等。")])])]),t._v(" "),s("li",[s("p",[t._v("函数定义")]),t._v(" "),s("p",[t._v("创建一个 myAdd.cpp 源文件，定义一个"),s("code",[t._v("funAdd")]),t._v("函数：")]),t._v(" "),s("div",{staticClass:"language-c++ extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('#include "myAdd.h"\nint funAdd(int a, int b)\n{\nreturn (a + b);\n}\n')])])]),s("p",[t._v("创建完 myAdd.h 和 myAdd.cpp 如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:n(278),alt:"04"}})])]),t._v(" "),s("li",[s("p",[t._v("修改配置类型为动态库.dll\n在项目配置中, 选择生成动态库.dll(确保你配置了 Debug 和 Release, 同时确保你在 x64 环境下生成):")]),t._v(" "),s("p",[s("img",{attrs:{src:n(279),alt:"03"}})])]),t._v(" "),s("li",[s("p",[t._v("生成 dll\n右键项目选择生成即可, 生成的 myDLL.dll 位于项目目录下的 x64/Debug 中(根据你项目的配置去找, x64 或 x86, Debug 或 Release)。")])]),t._v(" "),s("li",[s("p",[t._v("测试 dll\n将 myDLL.dll 拷贝至你的 electron 项目的根目录下的 dll 文件夹内\n在"),s("code",[t._v("main.js")]),t._v("中添加如下代码:")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ffi "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ffi-napi"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果前面已经定义过ffi, 就注释掉这一行")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// myDLL.dll")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" myDLL "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ffi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Library")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/myDLL"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 声明这个dll中的一个函数")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("funAdd")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"int"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"int"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"int"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用json的格式罗列其返回类型和参数类型")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 调用函数, 参数1和2, 将返回值直接打印出来, 预计为3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" myDLL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("funAdd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("the result of 1 + 2 is: ")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("启动程序：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("yarn start\n")])])]),s("p",[t._v("启动成功！shell 里打印出了相应的结果：")]),t._v(" "),s("p",[s("img",{attrs:{src:n(280),alt:"05"}})])])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("上面代码中，"),s("code",[t._v("ffi.Library")]),t._v("里第二个参数是一个 Json 结构，key 为方法名，value 为一个数组，数组的第一个参数是"),s("strong",[t._v("返回值类型")]),t._v("，第二个参数是包含所有"),s("strong",[t._v("传参类型")]),t._v("的子数组，如：如果返回值是空的话，那数组第一个参数应该是 void。如果返回值或者参数类型不知道是什么类型就写 void*。要使用 ffi 中的类型表示 C/C++语言中的类型，对照表如下：")]),t._v(" "),s("blockquote",[s("p",[t._v("基本类型\nint8--Signed 8-bit Integer\nuint8--Unsigned 8-bit Integer\nint16--Signed 16-bit Integer\nuint16--Unsigned 16-bit Integer\nint32--Signed 32-bit Integer\nuint32--Unsigned 32-bit Integer\nint64--Signed 64-bit Integer\nuint64--Unsigned 64-bit Integer\nfloat--Single Precision Floating Point Number (float)\ndouble--Double Precision Floating Point Number (double)\npointer--Pointer Type\nstring--Null-Terminated String (char *)\n常见的 C 语言类型\nbyte--unsigned char\nchar--char\nuchar--unsigned char\nshort--short\nushort--unsigned short\nint--int\nuint--unsigned int\nlong--long\nulong--unsigned long\nlonglong--long\nulonglong--unsigned long long\nsize_t--platform-dependent, usually pointer size")])]),t._v(" "),s("p",[t._v("如果是指针类型，可以引入"),s("code",[t._v("ref-napi")]),t._v("和"),s("code",[t._v("ref-array")]),t._v("模块来表示")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" ref "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ref-napi"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" refArray "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ref-array"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" intPtr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ref"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("refType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"int"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//int*类型")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" charPtr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//char*可以用string表示")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果是个字符数组")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" refArray "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ref-array"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" charPtrPtr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("refArray")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ref"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("types"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("char"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//50个大小的数组")]),t._v("\n")])])]),s("p",[t._v("假如参数或者返回值是一个结构体，那就需要借助"),s("code",[t._v("ref-struct")]),t._v("模块来表示")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" ref "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ref-napi"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("FFI")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ffi-napi"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" Struct "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ref-struct"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" TimeVal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Struct")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("tv_sec")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"long"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("tv_usec")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"long"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" TimeValPtr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ref"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("refType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TimeVal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" lib "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FFI"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Library")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("gettimeofday")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"int"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("TimeValPtr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pointer"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" tv "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeVal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nlib"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gettimeofday")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ref")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Seconds since epoch: "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" tv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tv_sec"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("注：更多 ref 插件的方法详见 ref 文档： https://tootallnate.github.io/ref/")])]),t._v(" "),s("h2",{attrs:{id:"可能出现的错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#可能出现的错误"}},[t._v("#")]),t._v(" 可能出现的错误")]),t._v(" "),s("blockquote",[s("p",[t._v("错误 1：LINK 126")])]),t._v(" "),s("p",[t._v("这个错误, 意味者 electron 无法使用你的 dll.")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" myDLL "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ffi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Library")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/myDLL'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n")])])]),s("p",[t._v("在上面这行代码中，"),s("code",[t._v("ffi.Library")]),t._v("的第一个参数, 不光指定了 dll 的名字, 还指定了 dll 的路径.\n出现 LINK 126 有两个常见原因:")]),t._v(" "),s("ol",[s("li",[t._v("没有这个"),s("strong",[t._v("目录")]),t._v(", 或这个目录下没有 "),s("code",[t._v("myDLL.dll")])]),t._v(" "),s("li",[s("code",[t._v("myDLL.dll")]),t._v(" 还"),s("strong",[t._v("依赖了其他")]),t._v("的一些 dll, 但是 electron 无法找到这个 dll.")])]),t._v(" "),s("blockquote",[s("p",[t._v("错误 2：LINK 127")])]),t._v(" "),s("p",[t._v("出现 LINK 127 的可能原因:")]),t._v(" "),s("ol",[s("li",[t._v("electron 找到了你的 dll, 但是在 dll 中"),s("strong",[t._v("找不到")]),t._v("你声名的函数(funAdd)。这通常是由于"),s("strong",[t._v("函数名字错误")]),t._v(", 或者是"),s("strong",[t._v("返回值类型")]),t._v("/"),s("strong",[t._v("参数的个数")]),t._v("及"),s("strong",[t._v("类型")]),t._v("不一致导致的.")])])])]),t._v(" "),s("h2",{attrs:{id:"references"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[t._v("#")]),t._v(" References")]),t._v(" "),s("ol",[s("li",[t._v("https://www.cnblogs.com/silenzio/p/11606389.html")]),t._v(" "),s("li",[t._v("https://segmentfault.com/a/1190000019402908?utm_source=tag-newest")])])])}),[],!1,null,null,null);s.default=e.exports}}]);