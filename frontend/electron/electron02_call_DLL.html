<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>electron02--è°ƒç”¨DLL | æ©å…¸å°ç«™</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Johnçš„åšå®¢">
    <meta name="author" content="johnzhu">
    <meta name="keywords" content="vuepressæ–‡æ¡£ vuepress blog">
    
    <link rel="preload" href="/assets/css/0.styles.815791d6.css" as="style"><link rel="preload" href="/assets/js/app.704be62a.js" as="script"><link rel="preload" href="/assets/js/3.6108c106.js" as="script"><link rel="preload" href="/assets/js/4.a4ae37d8.js" as="script"><link rel="prefetch" href="/assets/js/10.5a230cf6.js"><link rel="prefetch" href="/assets/js/11.f6ffb972.js"><link rel="prefetch" href="/assets/js/12.90c4a1ee.js"><link rel="prefetch" href="/assets/js/13.8d868104.js"><link rel="prefetch" href="/assets/js/14.9048c1ac.js"><link rel="prefetch" href="/assets/js/15.47f9d76a.js"><link rel="prefetch" href="/assets/js/16.399d0126.js"><link rel="prefetch" href="/assets/js/17.bbebbd91.js"><link rel="prefetch" href="/assets/js/18.476eb98c.js"><link rel="prefetch" href="/assets/js/19.ce17cee7.js"><link rel="prefetch" href="/assets/js/20.0cfb7e25.js"><link rel="prefetch" href="/assets/js/21.19c5ea84.js"><link rel="prefetch" href="/assets/js/22.69294388.js"><link rel="prefetch" href="/assets/js/23.8d07fb18.js"><link rel="prefetch" href="/assets/js/24.69458aa4.js"><link rel="prefetch" href="/assets/js/25.05c4b584.js"><link rel="prefetch" href="/assets/js/26.b6dfc973.js"><link rel="prefetch" href="/assets/js/27.ace5ec70.js"><link rel="prefetch" href="/assets/js/28.ead21d5b.js"><link rel="prefetch" href="/assets/js/29.f9ac53b9.js"><link rel="prefetch" href="/assets/js/30.3e3102b3.js"><link rel="prefetch" href="/assets/js/31.3e935e31.js"><link rel="prefetch" href="/assets/js/32.b8e9952e.js"><link rel="prefetch" href="/assets/js/33.798964c4.js"><link rel="prefetch" href="/assets/js/34.fe109888.js"><link rel="prefetch" href="/assets/js/35.da270765.js"><link rel="prefetch" href="/assets/js/36.fbfe366f.js"><link rel="prefetch" href="/assets/js/37.0cb928aa.js"><link rel="prefetch" href="/assets/js/38.6ba4c831.js"><link rel="prefetch" href="/assets/js/39.40702247.js"><link rel="prefetch" href="/assets/js/40.9407546b.js"><link rel="prefetch" href="/assets/js/41.bbe2a12c.js"><link rel="prefetch" href="/assets/js/42.107ab7e8.js"><link rel="prefetch" href="/assets/js/43.646d1249.js"><link rel="prefetch" href="/assets/js/44.db954469.js"><link rel="prefetch" href="/assets/js/45.f92074d5.js"><link rel="prefetch" href="/assets/js/46.1208d162.js"><link rel="prefetch" href="/assets/js/47.fee0be65.js"><link rel="prefetch" href="/assets/js/48.a4be6cf9.js"><link rel="prefetch" href="/assets/js/5.01d32a05.js"><link rel="prefetch" href="/assets/js/6.154c1b54.js"><link rel="prefetch" href="/assets/js/7.e000eb8b.js"><link rel="prefetch" href="/assets/js/8.3dc011e9.js"><link rel="prefetch" href="/assets/js/9.71d5f3e0.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.3733af1e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.815791d6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/apple-touch-icon.png" alt="æ©å…¸å°ç«™" class="logo"> <span class="site-name can-hide">æ©å…¸å°ç«™</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯" class="dropdown-title"><span class="title">å‰ç«¯</span> <span class="arrow down"></span></button> <button type="button" aria-label="å‰ç«¯" class="mobile-dropdown-title"><span class="title">å‰ç«¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/frontend/styling/" class="nav-link">
  Styling
</a></li><li class="dropdown-item"><!----> <a href="/frontend/electron/" class="nav-link router-link-active">
  electron
</a></li><li class="dropdown-item"><!----> <a href="/frontend/Qt/" class="nav-link">
  Qt
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åç«¯" class="dropdown-title"><span class="title">åç«¯</span> <span class="arrow down"></span></button> <button type="button" aria-label="åç«¯" class="mobile-dropdown-title"><span class="title">åç«¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/nodejs/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/backend/mongodb/" class="nav-link">
  MongoDB
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å¼€å‘å·¥å…·" class="dropdown-title"><span class="title">å¼€å‘å·¥å…·</span> <span class="arrow down"></span></button> <button type="button" aria-label="å¼€å‘å·¥å…·" class="mobile-dropdown-title"><span class="title">å¼€å‘å·¥å…·</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">
  Git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç¦éŸ³" class="dropdown-title"><span class="title">ç¦éŸ³</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç¦éŸ³" class="mobile-dropdown-title"><span class="title">ç¦éŸ³</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/gospel/GCL/" class="nav-link">
  GCL
</a></li><li class="dropdown-item"><!----> <a href="/gospel/newborn/" class="nav-link">
  åˆä¿¡é€ å°±
</a></li><li class="dropdown-item"><!----> <a href="/gospel/basics/" class="nav-link">
  åŸºè¦çœŸç†
</a></li><li class="dropdown-item"><!----> <a href="/gospel/practical/" class="nav-link">
  å®è·µç¥å­¦
</a></li><li class="dropdown-item"><!----> <a href="/gospel/evangelize/" class="nav-link">
  ä¼ æ‰¬ç¦éŸ³
</a></li><li class="dropdown-item"><!----> <a href="/gospel/Q&amp;A/" class="nav-link">
  é—®ç­”
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é“¾æ¥ğŸ‰" class="dropdown-title"><span class="title">é“¾æ¥ğŸ‰</span> <span class="arrow down"></span></button> <button type="button" aria-label="é“¾æ¥ğŸ‰" class="mobile-dropdown-title"><span class="title">é“¾æ¥ğŸ‰</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/more/stack.html" class="nav-link">
  æŠ€æœ¯
</a></li><li class="dropdown-item"><!----> <a href="/more/faith.html" class="nav-link">
  ä¿¡ä»°
</a></li><li class="dropdown-item"><!----> <a href="/more/others.html" class="nav-link">
  å…¶ä»–
</a></li><li class="dropdown-item"><!----> <a href="https://vuepress.vuejs.org/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress å®˜ç½‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/about.html" class="nav-link">
  å…³äº
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">é€‰æ‹©è¯­è¨€</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">é€‰æ‹©è¯­è¨€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/electron/electron02_call_DLL.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  ç®€ä½“ä¸­æ–‡
</a></li><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">
  English
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯" class="dropdown-title"><span class="title">å‰ç«¯</span> <span class="arrow down"></span></button> <button type="button" aria-label="å‰ç«¯" class="mobile-dropdown-title"><span class="title">å‰ç«¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/frontend/styling/" class="nav-link">
  Styling
</a></li><li class="dropdown-item"><!----> <a href="/frontend/electron/" class="nav-link router-link-active">
  electron
</a></li><li class="dropdown-item"><!----> <a href="/frontend/Qt/" class="nav-link">
  Qt
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åç«¯" class="dropdown-title"><span class="title">åç«¯</span> <span class="arrow down"></span></button> <button type="button" aria-label="åç«¯" class="mobile-dropdown-title"><span class="title">åç«¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/nodejs/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/backend/mongodb/" class="nav-link">
  MongoDB
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å¼€å‘å·¥å…·" class="dropdown-title"><span class="title">å¼€å‘å·¥å…·</span> <span class="arrow down"></span></button> <button type="button" aria-label="å¼€å‘å·¥å…·" class="mobile-dropdown-title"><span class="title">å¼€å‘å·¥å…·</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">
  Git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç¦éŸ³" class="dropdown-title"><span class="title">ç¦éŸ³</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç¦éŸ³" class="mobile-dropdown-title"><span class="title">ç¦éŸ³</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/gospel/GCL/" class="nav-link">
  GCL
</a></li><li class="dropdown-item"><!----> <a href="/gospel/newborn/" class="nav-link">
  åˆä¿¡é€ å°±
</a></li><li class="dropdown-item"><!----> <a href="/gospel/basics/" class="nav-link">
  åŸºè¦çœŸç†
</a></li><li class="dropdown-item"><!----> <a href="/gospel/practical/" class="nav-link">
  å®è·µç¥å­¦
</a></li><li class="dropdown-item"><!----> <a href="/gospel/evangelize/" class="nav-link">
  ä¼ æ‰¬ç¦éŸ³
</a></li><li class="dropdown-item"><!----> <a href="/gospel/Q&amp;A/" class="nav-link">
  é—®ç­”
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é“¾æ¥ğŸ‰" class="dropdown-title"><span class="title">é“¾æ¥ğŸ‰</span> <span class="arrow down"></span></button> <button type="button" aria-label="é“¾æ¥ğŸ‰" class="mobile-dropdown-title"><span class="title">é“¾æ¥ğŸ‰</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/more/stack.html" class="nav-link">
  æŠ€æœ¯
</a></li><li class="dropdown-item"><!----> <a href="/more/faith.html" class="nav-link">
  ä¿¡ä»°
</a></li><li class="dropdown-item"><!----> <a href="/more/others.html" class="nav-link">
  å…¶ä»–
</a></li><li class="dropdown-item"><!----> <a href="https://vuepress.vuejs.org/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress å®˜ç½‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/about.html" class="nav-link">
  å…³äº
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">é€‰æ‹©è¯­è¨€</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">é€‰æ‹©è¯­è¨€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/electron/electron02_call_DLL.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  ç®€ä½“ä¸­æ–‡
</a></li><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">
  English
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>electron</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/electron/" aria-current="page" class="sidebar-link">electron boilerplate</a></li><li><a href="/frontend/electron/electron_customize_window_button.html" class="sidebar-link">electron--è‡ªå®šä¹‰çª—å£æŒ‰é’®</a></li><li><a href="/frontend/electron/electron02_call_DLL.html" aria-current="page" class="active sidebar-link">electron02--è°ƒç”¨DLL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/electron/electron02_call_DLL.html#å¼•è¨€" class="sidebar-link">å¼•è¨€</a></li><li class="sidebar-sub-header"><a href="/frontend/electron/electron02_call_DLL.html#ffi" class="sidebar-link">ffi</a></li><li class="sidebar-sub-header"><a href="/frontend/electron/electron02_call_DLL.html#å®‰è£…-ffi" class="sidebar-link">å®‰è£… ffi</a></li><li class="sidebar-sub-header"><a href="/frontend/electron/electron02_call_DLL.html#è‡ªå·±ç”Ÿæˆä¸€ä¸ª-dll" class="sidebar-link">è‡ªå·±ç”Ÿæˆä¸€ä¸ª dll</a></li><li class="sidebar-sub-header"><a href="/frontend/electron/electron02_call_DLL.html#å¯èƒ½å‡ºç°çš„é”™è¯¯" class="sidebar-link">å¯èƒ½å‡ºç°çš„é”™è¯¯</a></li><li class="sidebar-sub-header"><a href="/frontend/electron/electron02_call_DLL.html#references" class="sidebar-link">References</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="electron-å­¦ä¹ -è°ƒç”¨-dll"><a href="#electron-å­¦ä¹ -è°ƒç”¨-dll" class="header-anchor">#</a> electron å­¦ä¹ --è°ƒç”¨ .dll</h1> <h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="header-anchor">#</a> å¼•è¨€</h2> <p>æœ¬æ–‡ä½¿ç”¨ node-ffi/ffi-napi è°ƒç”¨ C/C++ç¼–å†™çš„åŠ¨æ€é“¾æ¥åº“(å³ dll)ï¼Œä»¥å®ç°ä¸€äº›ç¡¬ä»¶åŠŸèƒ½ã€‚</p> <h2 id="ffi"><a href="#ffi" class="header-anchor">#</a> ffi</h2> <blockquote><p>node-ffi æ˜¯ä¸€ä¸ªç”¨äºä½¿ç”¨çº¯ JavaScript åŠ è½½å’Œè°ƒç”¨åŠ¨æ€åº“çš„ Node.js æ’ä»¶ã€‚å®ƒå¯ä»¥ç”¨æ¥åœ¨ä¸ç¼–å†™ä»»ä½• C++ä»£ç çš„æƒ…å†µä¸‹åˆ›å»ºä¸æœ¬åœ° DLL åº“çš„ç»‘å®šã€‚åŒæ—¶å®ƒè´Ÿè´£å¤„ç†è·¨ JavaScript å’Œ C çš„ç±»å‹è½¬æ¢ã€‚</p></blockquote> <ul><li>node-ffi è¿æ¥äº† C ä»£ç å’Œ JS ä»£ç , é€šè¿‡å†…å­˜å…±äº«æ¥å®Œæˆè°ƒç”¨, è€Œå†…éƒ¨åˆé€šè¿‡ ref,ref-array å’Œ ref-struct æ¥å®ç°ç±»å‹è½¬æ¢.</li></ul> <h2 id="å®‰è£…-ffi"><a href="#å®‰è£…-ffi" class="header-anchor">#</a> å®‰è£… ffi</h2> <blockquote><p>ffi-napi æ˜¯ä½œè€…(node-ffi-napi)æ ¹æ® node-ffi ä¿®æ”¹è€Œå‘å¸ƒåˆ° npm ä»“åº“çš„, å¯ä»¥ç›´æ¥é€šè¿‡ npm å®‰è£…, æ”¯æŒ node.js 12 å’Œ electron é«˜ç‰ˆæœ¬.</p></blockquote> <ol><li><p>éƒ¨ç½² node.js+electron ç¯å¢ƒ
è¯·è‡ªè¡Œå‚ç…§ç›¸å…³æ•™ç¨‹</p></li> <li><p>å®‰è£… ffi-napi</p> <div class="language- extra-class"><pre class="language-text"><code>yarn add ffi-napi
</code></pre></div></li> <li><p>ä½¿ç”¨ ffi
åœ¨<code>main.js</code>ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ffi <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ffi-napi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * å…ˆå®šä¹‰ä¸€ä¸ªå‡½æ•°, ç”¨æ¥åœ¨çª—å£ä¸­æ˜¾ç¤ºå­—ç¬¦
 * @param {String} text
 * @return {*} none
 */</span>
<span class="token keyword">function</span> <span class="token function">showText</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token string">&quot;ucs2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;binary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// é€šè¿‡ffiåŠ è½½user32.dll</span>
<span class="token keyword">const</span> myUser32 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ffi<span class="token punctuation">.</span>Library</span><span class="token punctuation">(</span><span class="token string">&quot;user32&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// å£°æ˜è¿™ä¸ªdllä¸­çš„ä¸€ä¸ªå‡½æ•°</span>
    <span class="token literal-property property">MessageBoxW</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;int32&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">&quot;int32&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;int32&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// ç”¨jsonçš„æ ¼å¼ç½—åˆ—å…¶è¿”å›ç±»å‹å’Œå‚æ•°ç±»å‹</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è°ƒç”¨user32.dllä¸­çš„MessageBoxW()å‡½æ•°, å¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†</span>
<span class="token keyword">const</span> isOk <span class="token operator">=</span> myUser32<span class="token punctuation">.</span><span class="token function">MessageBoxW</span><span class="token punctuation">(</span>
    <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token function">showText</span><span class="token punctuation">(</span><span class="token string">&quot;I am Node.JS!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">showText</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token number">1</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>isOk<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>å¯åŠ¨ç¨‹åºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>yarn start
</code></pre></div><p>å¯åŠ¨æˆåŠŸï¼å‡ºç°äº†å¼¹çª—ï¼š</p> <p><img src="data:image/png;base64,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" alt="01"></p></li></ol> <h2 id="è‡ªå·±ç”Ÿæˆä¸€ä¸ª-dll"><a href="#è‡ªå·±ç”Ÿæˆä¸€ä¸ª-dll" class="header-anchor">#</a> è‡ªå·±ç”Ÿæˆä¸€ä¸ª dll</h2> <ol start="0"><li>å¼€å§‹ä¹‹å‰</li></ol> <ul><li><p>æ³¨æ„ï¼š</p> <blockquote><p>ffi åªæ¥å—çº¯ C å‡½æ•°, ç¡®åˆ‡çš„è¯´, æ˜¯æŒ‰ç…§ C æ ‡å‡†ç¼–è¯‘çš„å‡½æ•°</p></blockquote> <p>ä¸‹é¢æ¥è¯´è¯´å…·ä½“çš„åŸå› :</p> <p>åœ¨é€šè¿‡ ffi å¼•å…¥ dll çš„æ—¶å€™, æˆ‘ä»¬æ˜¯è¿™ä¹ˆå£°æ˜çš„:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> myUser32 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ffi<span class="token punctuation">.</span>Library</span><span class="token punctuation">(</span><span class="token string">&quot;user32&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// å£°æ˜è¿™ä¸ªdllä¸­çš„ä¸€ä¸ªå‡½æ•°</span>
    <span class="token literal-property property">MessageBoxW</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;int32&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">&quot;int32&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;int32&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// ç”¨jsonçš„æ ¼å¼ç½—åˆ—å…¶è¿”å›ç±»å‹å’Œå‚æ•°ç±»å‹</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>åœ¨<code>user32.dll</code>ä¸­, å¯»æ‰¾ä¸€ä¸ªåå­—å«<code>MessageBoxW</code>çš„å‡½æ•°.</p> <p>ä½†æ˜¯, C å’Œ C++çš„å‡½æ•°å‘½åæ˜¯ä¸åŒçš„, æˆ‘æŒ‡çš„æ˜¯ç¼–è¯‘åçš„å‡½æ•°åå­—</p> <p>å¯¹äº C, å‡½æ•°<code>int func(int n)</code>ä¼šè¢«ç¼–è¯‘ä¸ºç±»ä¼¼<code>_func</code>è¿™æ ·çš„åå­—.</p> <p>å¯¹äº C++, å‡½æ•°<code>int func(int n)</code>ä¼šè¢«ç¼–è¯‘ä¸ºç±»ä¼¼<code>?func@@YAHH@Z</code>è¿™æ ·çš„åå­—.</p> <p>åŒæ ·æ˜¯ C++, å‡½æ•°<code>int func(int double)</code>ä¼šè¢«ç¼–è¯‘ä¸ºç±»ä¼¼<code>?func@@YAHN@Z</code>è¿™æ ·çš„åå­—(å’Œä¸Šä¸€ä¸ªä¸åŒ).</p> <p>åå­—ä¸­åŒ…å«äº†è¾ƒå¤šä¿¡æ¯, æ¯”å¦‚:</p> <blockquote><p>å‚æ•°çš„å…¥æ ˆæ–¹å¼
è¿”å›å€¼çš„ç±»å‹
å‚æ•°çš„ç±»å‹å’Œæ•°é‡</p></blockquote> <p>è¿™æ˜¯å› ä¸º C++æœ‰<code>å‡½æ•°é‡è½½</code>ç‰¹æ€§, è™½ç„¶å‡½æ•°å‘½åæ˜¯<code>func</code>, ä½†<code>int func(int n)</code>å’Œ<code>int func(int double)</code>å®Œå…¨æ˜¯ä¸¤ä¸ªä¸åŒçš„å‡½æ•°, ç¼–è¯‘å™¨é€šè¿‡ç»™å®ƒä»¬èµ‹äºˆä¸åŒçš„åå­—æ¥åŒºåˆ†å®ƒä»¬.ffi åœ¨ dll ä¸­æŸ¥æ‰¾å‡½æ•°åå­—çš„æ—¶å€™, <strong>æ˜¯ç”¨ C é£æ ¼æ¥æŸ¥æ‰¾çš„</strong>.</p> <ul><li>æ‰€ä»¥,å¦‚æœä½ çš„å‡½æ•°ä½¿ç”¨ C++ç¼–è¯‘çš„, ffl åœ¨è¿™ä¸ª dll ä¸­å°±æ‰¾ä¸åˆ°è¿™ä¸ªå‡½æ•°, ä¼šå‡ºç°é”™è¯¯<code>LINK 126</code>!</li></ul></li></ul> <ol><li><p>åˆ›å»ºå·¥ç¨‹</p> <p>ä½¿ç”¨ VS åˆ›å»ºä¸€ä¸ª C++ <strong>ç©ºé¡¹ç›®</strong>å³å¯. é¡¹ç›®åæˆä»¥ myDLL ä¸ºä¾‹ï¼ˆå½“ç„¶, ä½ ä¹Ÿå¯ä»¥ç›´æ¥åˆ›å»ºåŠ¨æ€é“¾æ¥åº“ DLLï¼‰:</p> <p><img src="/assets/img/2-2.9fbd880b.png" alt="02"></p></li> <li><p>å‡½æ•°å£°æ˜
åˆ›å»ºä¸€ä¸ª myAdd.h å¤´æ–‡ä»¶ï¼Œå¹¶å£°æ˜ä¸€ä¸ª<code>funAdd</code>å‡½æ•°ï¼š</p> <div class="language-c++ extra-class"><pre class="language-text"><code>extern &quot;C&quot;
{
    __declspec(dllexport) int funAdd(int a, int b);
}
</code></pre></div><p><code>extern &quot;C&quot;</code>çš„å«ä¹‰:</p> <blockquote><p>è¢« extern &quot;C&quot; ä¿®é¥°çš„å˜é‡å’Œå‡½æ•°æ˜¯æŒ‰ç…§ C è¯­è¨€æ–¹å¼ç¼–è¯‘å’Œé“¾æ¥çš„</p></blockquote> <p><code>__declspec(dllexport)</code>çš„å«ä¹‰:</p> <blockquote><p>__declspec(dllexport)ç”¨äº Windows ä¸­çš„åŠ¨æ€åº“ä¸­ï¼Œå£°æ˜å¯¼å‡ºå‡½æ•°ã€ç±»ã€å¯¹è±¡ç­‰ä¾›å¤–é¢è°ƒç”¨ï¼Œçœç•¥ç»™å‡º.def æ–‡ä»¶ã€‚å³å°†å‡½æ•°ã€ç±»ç­‰å£°æ˜ä¸ºå¯¼å‡ºå‡½æ•°ï¼Œä¾›å…¶å®ƒç¨‹åºè°ƒç”¨ï¼Œä½œä¸ºåŠ¨æ€åº“çš„å¯¹å¤–æ¥å£å‡½æ•°ã€ç±»ç­‰ã€‚</p></blockquote></li> <li><p>å‡½æ•°å®šä¹‰</p> <p>åˆ›å»ºä¸€ä¸ª myAdd.cpp æºæ–‡ä»¶ï¼Œå®šä¹‰ä¸€ä¸ª<code>funAdd</code>å‡½æ•°ï¼š</p> <div class="language-c++ extra-class"><pre class="language-text"><code>#include &quot;myAdd.h&quot;
int funAdd(int a, int b)
{
return (a + b);
}
</code></pre></div><p>åˆ›å»ºå®Œ myAdd.h å’Œ myAdd.cpp å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p> <p><img src="/assets/img/2-4.c2a4abd2.png" alt="04"></p></li> <li><p>ä¿®æ”¹é…ç½®ç±»å‹ä¸ºåŠ¨æ€åº“.dll
åœ¨é¡¹ç›®é…ç½®ä¸­, é€‰æ‹©ç”ŸæˆåŠ¨æ€åº“.dll(ç¡®ä¿ä½ é…ç½®äº† Debug å’Œ Release, åŒæ—¶ç¡®ä¿ä½ åœ¨ x64 ç¯å¢ƒä¸‹ç”Ÿæˆ):</p> <p><img src="/assets/img/2-3.de4797df.png" alt="03"></p></li> <li><p>ç”Ÿæˆ dll
å³é”®é¡¹ç›®é€‰æ‹©ç”Ÿæˆå³å¯, ç”Ÿæˆçš„ myDLL.dll ä½äºé¡¹ç›®ç›®å½•ä¸‹çš„ x64/Debug ä¸­(æ ¹æ®ä½ é¡¹ç›®çš„é…ç½®å»æ‰¾, x64 æˆ– x86, Debug æˆ– Release)ã€‚</p></li> <li><p>æµ‹è¯• dll
å°† myDLL.dll æ‹·è´è‡³ä½ çš„ electron é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹çš„ dll æ–‡ä»¶å¤¹å†…
åœ¨<code>main.js</code>ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ffi <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ffi-napi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¦‚æœå‰é¢å·²ç»å®šä¹‰è¿‡ffi, å°±æ³¨é‡Šæ‰è¿™ä¸€è¡Œ</span>
<span class="token comment">// myDLL.dll</span>
<span class="token keyword">const</span> myDLL <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ffi<span class="token punctuation">.</span>Library</span><span class="token punctuation">(</span><span class="token string">&quot;/myDLL&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// å£°æ˜è¿™ä¸ªdllä¸­çš„ä¸€ä¸ªå‡½æ•°</span>
    <span class="token literal-property property">funAdd</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;int&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">&quot;int&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;int&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// ç”¨jsonçš„æ ¼å¼ç½—åˆ—å…¶è¿”å›ç±»å‹å’Œå‚æ•°ç±»å‹</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è°ƒç”¨å‡½æ•°, å‚æ•°1å’Œ2, å°†è¿”å›å€¼ç›´æ¥æ‰“å°å‡ºæ¥, é¢„è®¡ä¸º3</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> myDLL<span class="token punctuation">.</span><span class="token function">funAdd</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">the result of 1 + 2 is: </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>å¯åŠ¨ç¨‹åºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>yarn start
</code></pre></div><p>å¯åŠ¨æˆåŠŸï¼shell é‡Œæ‰“å°å‡ºäº†ç›¸åº”çš„ç»“æœï¼š</p> <p><img src="/assets/img/2-5.442b2215.png" alt="05"></p></li></ol> <ul><li><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>ffi.Library</code>é‡Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª Json ç»“æ„ï¼Œkey ä¸ºæ–¹æ³•åï¼Œvalue ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<strong>è¿”å›å€¼ç±»å‹</strong>ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯åŒ…å«æ‰€æœ‰<strong>ä¼ å‚ç±»å‹</strong>çš„å­æ•°ç»„ï¼Œå¦‚ï¼šå¦‚æœè¿”å›å€¼æ˜¯ç©ºçš„è¯ï¼Œé‚£æ•°ç»„ç¬¬ä¸€ä¸ªå‚æ•°åº”è¯¥æ˜¯ voidã€‚å¦‚æœè¿”å›å€¼æˆ–è€…å‚æ•°ç±»å‹ä¸çŸ¥é“æ˜¯ä»€ä¹ˆç±»å‹å°±å†™ void*ã€‚è¦ä½¿ç”¨ ffi ä¸­çš„ç±»å‹è¡¨ç¤º C/C++è¯­è¨€ä¸­çš„ç±»å‹ï¼Œå¯¹ç…§è¡¨å¦‚ä¸‹ï¼š</p> <blockquote><p>åŸºæœ¬ç±»å‹
int8--Signed 8-bit Integer
uint8--Unsigned 8-bit Integer
int16--Signed 16-bit Integer
uint16--Unsigned 16-bit Integer
int32--Signed 32-bit Integer
uint32--Unsigned 32-bit Integer
int64--Signed 64-bit Integer
uint64--Unsigned 64-bit Integer
float--Single Precision Floating Point Number (float)
double--Double Precision Floating Point Number (double)
pointer--Pointer Type
string--Null-Terminated String (char *)
å¸¸è§çš„ C è¯­è¨€ç±»å‹
byte--unsigned char
char--char
uchar--unsigned char
short--short
ushort--unsigned short
int--int
uint--unsigned int
long--long
ulong--unsigned long
longlong--long
ulonglong--unsigned long long
size_t--platform-dependent, usually pointer size</p></blockquote> <p>å¦‚æœæ˜¯æŒ‡é’ˆç±»å‹ï¼Œå¯ä»¥å¼•å…¥<code>ref-napi</code>å’Œ<code>ref-array</code>æ¨¡å—æ¥è¡¨ç¤º</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> ref <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ref-napi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> refArray <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ref-array&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> intPtr <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token function">refType</span><span class="token punctuation">(</span><span class="token string">&quot;int&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//int*ç±»å‹</span>
<span class="token keyword">var</span> charPtr <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span> <span class="token comment">//char*å¯ä»¥ç”¨stringè¡¨ç¤º</span>

<span class="token comment">//å¦‚æœæ˜¯ä¸ªå­—ç¬¦æ•°ç»„</span>
<span class="token keyword">var</span> refArray <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ref-array&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> charPtrPtr <span class="token operator">=</span> <span class="token function">refArray</span><span class="token punctuation">(</span>ref<span class="token punctuation">.</span>types<span class="token punctuation">.</span>char<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//50ä¸ªå¤§å°çš„æ•°ç»„</span>
</code></pre></div><p>å‡å¦‚å‚æ•°æˆ–è€…è¿”å›å€¼æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œé‚£å°±éœ€è¦å€ŸåŠ©<code>ref-struct</code>æ¨¡å—æ¥è¡¨ç¤º</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> ref <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ref-napi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token constant">FFI</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ffi-napi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Struct <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ref-struct&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> TimeVal <span class="token operator">=</span> <span class="token function">Struct</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">tv_sec</span><span class="token operator">:</span> <span class="token string">&quot;long&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">tv_usec</span><span class="token operator">:</span> <span class="token string">&quot;long&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> TimeValPtr <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token function">refType</span><span class="token punctuation">(</span>TimeVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> lib <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FFI<span class="token punctuation">.</span>Library</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">gettimeofday</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;int&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>TimeValPtr<span class="token punctuation">,</span> <span class="token string">&quot;pointer&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> tv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TimeVal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
lib<span class="token punctuation">.</span><span class="token function">gettimeofday</span><span class="token punctuation">(</span>tv<span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Seconds since epoch: &quot;</span> <span class="token operator">+</span> tv<span class="token punctuation">.</span>tv_sec<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>æ³¨ï¼šæ›´å¤š ref æ’ä»¶çš„æ–¹æ³•è¯¦è§ ref æ–‡æ¡£ï¼š https://tootallnate.github.io/ref/</strong></p> <h2 id="å¯èƒ½å‡ºç°çš„é”™è¯¯"><a href="#å¯èƒ½å‡ºç°çš„é”™è¯¯" class="header-anchor">#</a> å¯èƒ½å‡ºç°çš„é”™è¯¯</h2> <blockquote><p>é”™è¯¯ 1ï¼šLINK 126</p></blockquote> <p>è¿™ä¸ªé”™è¯¯, æ„å‘³è€… electron æ— æ³•ä½¿ç”¨ä½ çš„ dll.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> myDLL <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ffi<span class="token punctuation">.</span>Library</span><span class="token punctuation">(</span><span class="token string">'/myDLL'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</code></pre></div><p>åœ¨ä¸Šé¢è¿™è¡Œä»£ç ä¸­ï¼Œ<code>ffi.Library</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°, ä¸å…‰æŒ‡å®šäº† dll çš„åå­—, è¿˜æŒ‡å®šäº† dll çš„è·¯å¾„.
å‡ºç° LINK 126 æœ‰ä¸¤ä¸ªå¸¸è§åŸå› :</p> <ol><li>æ²¡æœ‰è¿™ä¸ª<strong>ç›®å½•</strong>, æˆ–è¿™ä¸ªç›®å½•ä¸‹æ²¡æœ‰ <code>myDLL.dll</code></li> <li><code>myDLL.dll</code> è¿˜<strong>ä¾èµ–äº†å…¶ä»–</strong>çš„ä¸€äº› dll, ä½†æ˜¯ electron æ— æ³•æ‰¾åˆ°è¿™ä¸ª dll.</li></ol> <blockquote><p>é”™è¯¯ 2ï¼šLINK 127</p></blockquote> <p>å‡ºç° LINK 127 çš„å¯èƒ½åŸå› :</p> <ol><li>electron æ‰¾åˆ°äº†ä½ çš„ dll, ä½†æ˜¯åœ¨ dll ä¸­<strong>æ‰¾ä¸åˆ°</strong>ä½ å£°åçš„å‡½æ•°(funAdd)ã€‚è¿™é€šå¸¸æ˜¯ç”±äº<strong>å‡½æ•°åå­—é”™è¯¯</strong>, æˆ–è€…æ˜¯<strong>è¿”å›å€¼ç±»å‹</strong>/<strong>å‚æ•°çš„ä¸ªæ•°</strong>åŠ<strong>ç±»å‹</strong>ä¸ä¸€è‡´å¯¼è‡´çš„.</li></ol></li></ul> <h2 id="references"><a href="#references" class="header-anchor">#</a> References</h2> <ol><li>https://www.cnblogs.com/silenzio/p/11606389.html</li> <li>https://segmentfault.com/a/1190000019402908?utm_source=tag-newest</li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">æ›´æ–°æ—¶é—´:</span> <span class="time">2023/2/9 22:20:49</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/frontend/electron/electron_customize_window_button.html" class="prev">
        electron--è‡ªå®šä¹‰çª—å£æŒ‰é’®
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.704be62a.js" defer></script><script src="/assets/js/3.6108c106.js" defer></script><script src="/assets/js/4.a4ae37d8.js" defer></script>
  </body>
</html>
